/*
 * R3 Proprietary and Confidential
 *
 * Copyright (c) 2018 R3 Limited.  All rights reserved.
 *
 * The intellectual and technical concepts contained herein are proprietary to R3 and its suppliers and are protected by trade secret law.
 *
 * Distribution of this file or any portion thereof via any medium without the express permission of R3 is strictly prohibited.
 */

apply plugin: 'net.corda.plugins.publish-utils'
apply plugin: 'us.kirchmeier.capsule'
apply plugin: 'com.jfrog.artifactory'

description 'Doorman default'

version project(':network-management').version

configurations {
    runtimeArtifacts.extendsFrom runtime
}

task buildHsmJAR(type: FatCapsule, dependsOn: 'jar') {
    applicationClass 'com.r3.corda.networkmanage.hsm.MainKt'
    archiveName "hsm-${version}.jar"
    capsuleManifest {
        applicationVersion = corda_release_version
        systemProperties['visualvm.display.name'] = 'HSM Signing Service'
        minJavaVersion = '1.8.0'
        jvmArgs = ['-XX:+UseG1GC']
    }
    applicationSource = files(
        project(':network-management').configurations.runtime,
        project(':network-management').jar
    )
    tasks.withType(Jar) { task ->
        manifest {
            attributes('Signing-Service-Version': version)
        }
    }
}

artifacts {
    runtimeArtifacts buildHsmJAR
    publish buildHsmJAR
}

jar {
    classifier "ignore"
}

publish {
    name 'doorman-hsm'
    disableDefaultJar = true
}